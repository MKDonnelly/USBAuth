USB authentication

How it works:
  This program runs as a daemon. It checks if the usb drive is inserted
  by watching the available uuids.  When the drive is inserted, the 
  file ".usbkey" on the drive is copied off the drive. This file will
  contain lots of random data which is used as a key.  The sha512sum
  of the ".usbkey" file is compared to a previous sha512sum of the file.
  If they match, authentication is granted and the provided command is run.
  Thereafter, the daemon watches for the drive to be removed and subsequently
  deauthenticate the user by running the provided command. A single instance
  of the daemon only handles a single usb authentication. 

Generate a key:
  To generate a key, run 
  ./makekey <usb drive name> <key output name> <key length>
  This script places a bunch of random information into a file 
  called .usbkey and moves it to the usb drive. The hash of .usbkey, 
  as well as the uuid of the drive it is stored on, is placed into an output
  file which can be used by the main program.

Command line arguments:
  The user provides four command line arguments: The trusted key file
  (generated by ./makekey, see above), the command to run when 
  authenticated (must be enclosed by quotes), the command to
  run when deauthenticated (must be enclosed by quotes), and the maximum
  tolerable delay. For example,
  "./<main program> authentickey 'echo authenticated' 'echo deauthenticated' 5"
  Waits for the drive with the same uuid in authentickey to be plugged
  in. Once it is plugged in, the program determines if the key is authentic.
  If the key is not authentic, nothing happens. If it is authentic, then
  'echo authenticated' is run. Once the drive is removed, 
  'echo deauthenticated' is run. The daemon waits for up to five seconds
  before authenticating and deauthenticating the usb drive. The "5" sets
  the delay before each check for authentication and deauthentication
  to prevent the loop from consuming too much cpu.

Special requirements:
  Since this program does use blkid and, presumably, manages user accounts,
  it must be run as root.

File forms:
  The key file will be in the form:
  "# (<- This space is important!) <uuid of drive>
   hhhhhhhhhhhhhhhhhhhhhaaaaaaaaaaaaaaaaaassssssssssssssssshhhhhhhhhhh .usbkey"
  The .usbkey file will be a bunch of random garbage
